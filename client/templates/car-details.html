<template name="carDetails">
  <main role="main" class="container">
    {{#if isSuccessfulEditAd}}
      <div class="bs-callout bs-callout-success bs-callout-success-fill">
        <p>
          Anuncio editado correctamente.
        </p>
      </div>
    {{/if}}
    {{#with car}}
    <article itemscope itemtype="https://schema.org/Car" class="car-details-short">
      {{>picsCarousel car=car}}
      <div id="car-details-spec" class="row">
        <div class="col-md-8">
          <header>
            <h1 itemprop="name" class="h2 car-details-title">
              {{#if active}}
                {{#unless published}}
                  <span class="btn-warning btn">Anuncio esperando aprobación</span>
                {{/unless}}
              {{else}}
                {{#if published}}
                  <span class="btn-danger btn">Este anuncio ha terminado</span>
                {{else}}
                  <span class="btn-danger btn">Anuncio no aprobado</span>
                {{/if}}
              {{/if}}
              <strong>{{make}}</strong> {{title}}
            </h1>
          </header>
          <p><span class="property-title">Localización:</span> {{district.district}} ({{district.region}})</p>
          {{#if color}}
            <p><span class="property-title">Color:</span> <span itemprop="color">{{color}}</span></p>
          {{/if}}
          {{#if wheelDrive}}
            <p><span class="property-title">Tracción:</span> <span itemprop="driveWheelConfiguration">{{wheelDrive}}</span></p>
          {{/if}}
          {{#if owners}}
            <p><span class="property-title">Número de propietarios:</span> <span itemprop="numberOfPreviousOwners">{{owners}}</span></p>
          {{/if}}
          <hr />
          <p><span class="property-title">Descripción:</span></p>
          <p>{{#markdown}}{{description}}{{/markdown}}</p>
          {{#if maintenance}}
            <p><span class="property-title">Mantenimiento:</span></p>
            <p><span>{{#markdown}}{{maintenance}}{{/markdown}}</span></p>
          {{/if}}
          {{#if warranty}}
            <p><span class="property-title">Garantía:</span></p>
            <p><span>{{#markdown}}{{warranty}}{{/markdown}}</span></p>
          {{/if}}
        </div>
        <div class="col-md-4">
          <div id="car-details-data">
            <table class="table car-details">
              <tr>
                <td>Precio</td>
                <td class="text-right"><b>{{price}} €</b></td>
              </tr>
              <tr>
                <td>Potencia</td>
                <td class="text-right"><b>{{horsepower}} cv</b></td>
              </tr>
              <tr>
                <td>Combustible</td>
                <td class="text-right"><b><span itemprop="fuelType">{{fuel}}</span></b></td>
              </tr>
              <tr>
                <td>Transmisión</td>
                <td class="text-right"><b><span itemprop="vehicleTransmission">{{transmission}}</span></b></td>
              </tr>
              <tr>
                <td>Año</td>
                <td class="text-right"><b><span itemprop="dateVehicleFirstRegistered">{{year}}</span></b></td>
              </tr>
              <tr>
                <td>Kilómetros</td>
                <td class="text-right"><b>{{kilometers}}</b></td>
              </tr>
              <tr>
                <td>Tipo de carrocería</td>
                <td class="text-right"><b>{{body}}</b></td>
              </tr>
              <tr>
                <td>Número de puertas</td>
                <td class="text-right"><b><span itemprop="numberOfDoors">{{doors}}</span></b></td>
              </tr>
            </table>

            {{#if active}}
              {{#if published}}
                {{#unless showContactOwnerForm}}
                <p>
                  <a id="contact-owner" class="btn btn-danger scroll">Contactar con vendedor</a>
                </p>
                {{/unless}}
                {{#if showContactOwnerForm}}
                  {{>contactOwnerForm carId=_id}}
                {{/if}}
              {{/if}}
            {{/if}}
          </div>
        </div>
      </div>
    </article>
    {{/with}}
  </main>
</template>

<template name="picsCarousel">
  {{#with car}}
  <div id="car-details-images" class="text-center owl-carousel owl-theme">
    {{#each images}}
    <div class="item">
      <a href="{{url store="images"}}" title="Ver foto #{{@index}} de {{../make}} {{../title}}" target="_blank" class="fluidbox-img">
        <img src="{{url store="thumbs-retina"}}" alt="{{make}} {{title}} ({{@index}})" class="img-thumbnail" />
      </a>
    </div>
    {{/each}}
  </div>
  {{/with}}
</template>


<template name="contactOwnerForm">
  <fieldset>
    <legend>Contacta con el anunciante</legend>
    {{#if isSuccessfulContactOwner}}
      <span id="success-contact-owner-form"><strong>Tu mensaje al vendedor ha sido enviado.</strong> Muchas gracias.</span>
    {{else}}
      {{#autoForm schema=contactOwnerFormSchema id="contactOwnerForm" type="method" meteormethod="sendOwnerEmail"}}
      {{> afQuickField id="form-carId" name="carId" value=carId type="hidden"}}
      {{> afQuickField id="form-name" name="name" label="Nombre"}}
      {{> afQuickField id="form-email" name="email" label="Email"}}
      {{> afQuickField id="form-message" name="message" label="Mensaje" rows=10}}
      <div>
        <button type="submit" class="btn btn-primary">Enviar</button>
      </div>
      {{/autoForm}}
    {{/if}}
  </fieldset>
</template>
